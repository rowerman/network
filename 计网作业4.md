##### 4-03

* 物理层使用的中间设备叫做转发器
* 数据链路层使用的中间设备叫做网桥或交换机
* 网络层使用的中间设备交路由器
* 在网络层以上使用的中间设备叫网关

##### 4-17

使用了6次ARP，主机发送IP数据报时使用一次ARP，每一个路由器在转发数据报时使用一次

##### 4-18

* $128.96.39.10 \rightarrow 10000000\; 01100000\; 00100111 \; 00001010$

  转发表第二行对应的子网掩码：$11111111 \; 11111111 \; 11111111 \; 10000000$

  按位与得到：$10000000\; 01100000 \; 00100111 \; 00000000$，转换为十进制：128.96.39.0

  所得结果匹配，选择下一跳为接口$m_0$

* $128.96.40.12 \rightarrow 10000000 \; 01100000 \; 00101000 \; 00001100$

  转发表第四行对应的子网掩码：$11111111 \; 11111111 \; 11111111 \; 10000000$

  按位与得到：$10000000 \; 01100000 \; 00101000 \; 00001100$，转换为十进制：128.96.40.0

  所得结果匹配，选择下一跳为$R_2$

* $128.96.40.151 \rightarrow 10000000 \; 01100000 \; 00101000 \; 10010111$

  转发表第四行对应的子网掩码：$11111111 \; 11111111 \; 11111111 \; 10000000$

  按位与得到：$10000000 \; 01100000 \; 00101000 \; 10000000$，转换为十进制：128.96.40.128

  所得结果不匹配，其他行均不匹配，故选择默认接口$R_4$

* $192.4.153.17 \rightarrow 11000000 \; 00000100 \; 10011001 \; 00010001$

  转发表第一行对应的子网掩码：$11111111 \; 11111111 \; 11111111 \; 11000000$

  按位与得到：$11000000 \; 00000100 \; 10011001 \; 00000000$，转换为十进制：192.4.153.0

  所得结果匹配，选择下一跳为$R_3$

* $192.4.153.90 \rightarrow 11000000 \; 00000100 \; 10011001 \; 01011010$

  转发表第一行对应的子网掩码：$11111111 \; 11111111 \; 11111111 \; 11000000$

  按位与得到：$11000000 \; 00000100 \; 10011001 \; 01000000$，转换为十进制：192.4.153.64

  所得结果不匹配，其他行均不匹配，故选择默认接口$R_4$

##### 4-19

该单位平均每个地点有250台设备，所以主机号8位即可，结果如下：

* 129.250.1.0/24，IP范围：129.250.1.0~129.250.1.255
* 129.250.2.0/24，IP范围：129.250.2.0~129.250.2.255
* $\cdots$
* 129.250.16.0/24，IP范围：129.250.16.0~129.250.16.255

##### 4-20

应当划分为3个数据报片，IP数据报的数据部分长度为3980字节

* 第一个数据报片：数据字段长1480字节，片偏移字段=0，MF=1
* 第二个数据报片：数据字段长1480字节，片偏移字段=1480/8=185，MF=1
* 第三个数据报片：数据字段长1020字节，片偏移字段=2960/8=370，MF=0

##### 4-22

观察易得这几个地址块的第三个字节只有最后两位不一样，前面6位均相同，所以这四个地址块的共同前缀是22位，最大聚合CIDR地址块：$212.56.132.0/22$

##### 4-26

分配给每个局域网的IP数量必须大于等于局域网主机数+2

为各个局域网分配的主机数及网络前缀：

* $LAN_1:64$，前缀：192.77.33.0/26
* $LAN_3:32$，前缀：192.77.33.64/27
* $LAN_6:32$，前缀：192.77.33.96/27
* $LAN_7:32$，前缀：192.77.33.128/27
* $LAN_8:32$，前缀：192.77.33.160/27
* $LAN_2:16$，前缀：192.77.33.192/28
* $LAN_4:16$，前缀：192.77.33.208/28
* $LAN_5:8$，前缀：192.77.33.224/29
* $WAN_1:4$，前缀：192.77.33.232/30
* $WAN_2:4$，前缀：192.77.33.236/30
* $WAN_3:4$，前缀：192.77.33.240/30

##### 4-33

（1）原来的网络前缀为26位，要划分为4个相同大小的子网，则网络前缀还要再加2位，所以每个子网前缀为**28**位

（2）每个子网中主机号占4位，故每个子网块中有16个地址（14个可用）

（3）4个子网的地址块：

136.23.12.64/28、136.23.12.80/28、136.23.12.96/28、136.23.12.112/28

（4）

* 第一个子网：最小地址为136.23.12.65，最大地址为136.23.12.78
* 第二个子网：最小地址为136.23.12.81，最大地址为136.23.12.94
* 第三个子网：最小地址为136.23.12.97，最大地址为136.23.12.110
* 第四个子网：最小地址为136.23.12.113，最大地址为136.23.12.126

##### 4-37

第一步：将C发来的路由信息改写为（目的网络  距离  下一跳路由器）：

* $N_2 \qquad 5 \qquad C$
* $N_3 \qquad 9 \qquad C$
* $N_6 \qquad 5 \qquad C$
* $N_8 \qquad 4 \qquad C$
* $N_9 \qquad 6 \qquad C$

第二步：根据B中原有路由信息和改写后的信息更新路由表

* $N_1 \qquad 7 \qquad A$：无新信息，不改变
* $N_2 \qquad 5 \qquad C$：C到N2距离增大，需要更新
* $N_3 \qquad 9 \qquad C$：新项目，加入路由表
* $N_6 \qquad 5 \qquad C$：选择C为下一跳更短，故更新
* $N_8 \qquad 4 \qquad E$：距离一样，不改变
* $N_9 \qquad 4 \qquad F$：若下一跳为C距离变远，不改变

##### 4-38

（1）路由器$R_{3c}$使用协议eBGP从$AS_4$的$R_{4c}$知道前缀X

（2）路由器$R_{3a}$使用协议iBGP从本自治系统的$R_{3c}$知道前缀X

（3）路由器$R_{1c}$使用协议eBGP从$AS_3$的$R_{3c}$知道前缀X

（4）路由器$R_{1d}$使用协议iBGP从本自治系统的$R_{1c}$知道前缀X

##### 4-42

* NAT是网络地址转换
* NAPT是网络地址和端口号转换，是使用端口号的NAT
* 优点：可以通过NAT路由器是专用网内部的用户和公网连接
* 缺点：NAT路由器的通信只能由专用网内部的主机发起，这使得专用网内部的主机不能当作服务器使用；除此之外，只有一个公网IP的NAT路由器同时只能为一个专用网内部的主机提供服务

##### 4-48

（1）

| 网络前缀        | 下一跳                |
| --------------- | --------------------- |
| 145.13.0.0/18   | 直接交付，接口$m_0$   |
| 145.13.64.0/18  | 直接交付，接口$m_1$   |
| 145.13.128.0/18 | 直接交付，接口$m_2$   |
| 145.13.192.0/18 | 直接交付，接口$m_3$   |
| 0.0.0.0/0       | 默认路由器，接口$m_4$ |

（2）第一行的子网掩码为：11111111  11111111  11000000  00000000，将目的地址145.13.160.78转化成二进制后和子网掩码进行按位与得到145.13.128.0，与第一行网络前缀不匹配。但不需要再进行运算，因为表中每一行的子网掩码都相同，观察知得到的结果与第三行的网络前缀匹配，所以选择接口**$m_2$**转发

##### 4-66

| 匹配                                                | 动作      |
| --------------------------------------------------- | --------- |
| 入端口=1；IP源地址=10.3.\*.*；IP目的地址=10.1.\*.\* | 转发（2） |
| 入端口=2；IP源地址=10.1.\*.*；IP目的地址=10.3.\*.\* | 转发（1） |
| 入端口=*；IP源地址=10.3.\*.\*；IP目的地址=10.2.0.3  | 转发（3） |
| 入端口=*；IP源地址=10.3.\*.\*；IP目的地址=10.2.0.4  | 转发（4） |
| 入端口=3；IP源地址=10.2.0.3；IP目的地址=10.2.0.4    | 转发（4） |
| 入端口=4；IP源地址=10.2.0.4；IP目的地址=10.2.0.3    | 转发（3） |
| ……                                                  | ……        |

